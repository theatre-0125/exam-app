<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>問題データ加工ツール</title>
<style>
  body {
    font-family: system-ui, sans-serif;
    padding: 20px;
    max-width: 900px;
    margin: auto;
  }
  textarea {
    width: 100%;
    height: 220px;
    margin-bottom: 16px;
    font-family: monospace;
  }
  button {
    padding: 10px 16px;
    margin-right: 8px;
    cursor: pointer;
  }
  pre {
    background: #f6f8fa;
    padding: 16px;
    white-space: pre-wrap;
    border-radius: 6px;
  }
</style>
</head>
<body>

<h2>問題文入力</h2>
<textarea id="questionInput" placeholder="問題文を貼り付け"></textarea>

<h2>解説文入力</h2>
<textarea id="explanationInput" placeholder="解説文を貼り付け"></textarea>

<button onclick="convert()">変換</button>
<button onclick="copyOutput()">コピー</button>

<input type="number" id="startId" value="1" style="width: 60px;" />

<h2>出力</h2>
<pre id="output"></pre>

<script>
function convert() {
  const questionText = document.getElementById("questionInput").value;
  const explanationText = document.getElementById("explanationInput").value;

  const startId = parseInt(document.getElementById("startId").value, 10) || 1;

  const questions = questionText.split(/Q\d+\./).filter(Boolean);
  const answers = explanationText.split(/A\d+\./).filter(Boolean);

  const result = questions.map((q, index) => {
    const lines = q.trim().split("\n").map(l => l.trim()).filter(Boolean);

    const question = lines[0];
    const choices = lines.slice(1).map(l => l.replace(/^[A-D]\.\s*/, ""));

    const answerBlock = answers[index];
    const answerLine = answerBlock.match(/\b[A-D]\b/)?.[0];
    const explanation = answerBlock.split("解説：")[1]?.trim() || "";
    console.log({ answerBlock, answerLine, explanation });

    const answerIndex = answerLine
      ? choices["ABCD".indexOf(answerLine)]
      : "";

    return {
      id: index + startId,
      question,
      choices,
      answerIndex,
      explanation
    };
  });

  document.getElementById("output").textContent =
    JSON.stringify(result, null, 2);
}

function copyOutput() {
  const text = document.getElementById("output").textContent;
  navigator.clipboard.writeText(text);
  alert("コピーしました");
}
</script>

</body>
</html>
